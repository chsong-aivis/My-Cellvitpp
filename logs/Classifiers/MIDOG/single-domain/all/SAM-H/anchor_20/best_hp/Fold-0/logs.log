[37m2024-05-28 07:46:46,646 [INFO] - Instantiated Logger. WandB init and config update finished.
[37m2024-05-28 07:46:46,647 [INFO] - Run ist stored here: /cellvit/logs_paper/Head-Evaluation/MIDOG/single-domain/all/SAM-H/anchor_20/best_hp/2024-05-28T074638_CellViT-SAM-H-Classifier-Head-Fold-0
[37m2024-05-28 07:46:46,706 [INFO] - Cuda devices: [<torch.cuda.device object at 0x7fcb26f07fd0>]
[37m2024-05-28 07:46:46,711 [INFO] - Using GPU: cuda:0
[37m2024-05-28 07:46:46,715 [INFO] - Using device: cuda:0
[37m2024-05-28 07:46:46,721 [INFO] - Loss function:
[37m2024-05-28 07:46:46,727 [INFO] - CrossEntropyLoss()
[37m2024-05-28 07:47:33,854 [INFO] - <All keys matched successfully>
[37m2024-05-28 07:47:37,438 [INFO] -
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
LinearClassifier                         [1, 2]                    --
â”œâ”€Linear: 1-1                            [1, 512]                  655,872
â”œâ”€ReLU: 1-2                              [1, 512]                  --
â”œâ”€Dropout: 1-3                           [1, 512]                  --
â”œâ”€Linear: 1-4                            [1, 2]                    1,026
==========================================================================================
Total params: 656,898
Trainable params: 656,898
Non-trainable params: 0
Total mult-adds (M): 0.66
==========================================================================================
Input size (MB): 0.01
Forward/backward pass size (MB): 0.00
Params size (MB): 2.63
Estimated Total Size (MB): 2.64
==========================================================================================
[37m2024-05-28 07:47:37,448 [INFO] - Loaded AdamW Optimizer with following hyperparameters:
[37m2024-05-28 07:47:37,454 [INFO] - {'betas': [0.85, 0.9], 'lr': 1.3720338613429816e-05, 'weight_decay': 0.0009752830235894076}
[37m2024-05-28 07:47:37,460 [INFO] - Using early stopping with a range of 5 and maximize strategy
[37m2024-05-28 07:47:38,640 [INFO] - Instantiate Trainer
[37m2024-05-28 07:47:38,710 [INFO] - Calling Trainer Fit
[37m2024-05-28 07:47:38,715 [INFO] - Dataset is cached after first epoch
[37m2024-05-28 07:47:38,723 [INFO] - Starting training, total number of epochs: 50
[37m2024-05-28 07:47:38,728 [INFO] - Epoch: 1/50
[37m2024-05-28 07:48:25,637 [INFO] - Loaded dataset from cache: midog-volume/data/cache/1f9de762fb5a66006f9cc8860d435dd07713dbc4da28989080f3a3637c6beac8.h5
[37m2024-05-28 07:48:34,771 [INFO] - Training epoch stats:     Loss: 0.1081 - F1-Score: 0.9745 - Accuracy-Score: 0.9522 - AUROC: 0.9710 - AP: 0.9978
[37m2024-05-28 07:48:45,273 [INFO] - Loaded dataset from cache: midog-volume/data/cache/a100bbcd81d10189d27fceb61c51e95631064f67308ee9b6b793e392e61186d0.h5
[37m2024-05-28 07:48:46,120 [INFO] - Validation epoch stats:   Loss: 0.0768 - F1-Score: 0.9810 - Accuracy-Score: 0.9640 - AUROC: 0.9830 - AP: 0.9989
[37m2024-05-28 07:48:46,126 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:50:10,635 [INFO] - Final WSI level detection score (mAP): 0.3430
[37m2024-05-28 07:50:10,707 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:50:11,046 [INFO] - Epoch: 2/50
[37m2024-05-28 07:50:18,349 [INFO] - Training epoch stats:     Loss: 0.0759 - F1-Score: 0.9811 - Accuracy-Score: 0.9648 - AUROC: 0.9862 - AP: 0.9990
[37m2024-05-28 07:50:19,042 [INFO] - Validation epoch stats:   Loss: 0.0721 - F1-Score: 0.9824 - Accuracy-Score: 0.9667 - AUROC: 0.9850 - AP: 0.9991
[37m2024-05-28 07:50:19,047 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:51:20,881 [INFO] - Final WSI level detection score (mAP): 0.3978
[37m2024-05-28 07:51:20,968 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:51:21,310 [INFO] - Epoch: 3/50
[37m2024-05-28 07:51:26,854 [INFO] - Training epoch stats:     Loss: 0.0708 - F1-Score: 0.9827 - Accuracy-Score: 0.9677 - AUROC: 0.9881 - AP: 0.9991
[37m2024-05-28 07:51:28,020 [INFO] - Validation epoch stats:   Loss: 0.0702 - F1-Score: 0.9827 - Accuracy-Score: 0.9674 - AUROC: 0.9858 - AP: 0.9991
[37m2024-05-28 07:51:28,026 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:52:25,415 [INFO] - Final WSI level detection score (mAP): 0.4277
[37m2024-05-28 07:52:25,462 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:52:25,799 [INFO] - Epoch: 4/50
[37m2024-05-28 07:52:32,429 [INFO] - Training epoch stats:     Loss: 0.0669 - F1-Score: 0.9838 - Accuracy-Score: 0.9699 - AUROC: 0.9894 - AP: 0.9992
[37m2024-05-28 07:52:33,600 [INFO] - Validation epoch stats:   Loss: 0.0706 - F1-Score: 0.9824 - Accuracy-Score: 0.9669 - AUROC: 0.9864 - AP: 0.9992
[37m2024-05-28 07:52:33,605 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:53:33,531 [INFO] - Final WSI level detection score (mAP): 0.4289
[37m2024-05-28 07:53:33,584 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:53:33,895 [INFO] - Epoch: 5/50
[37m2024-05-28 07:53:40,948 [INFO] - Training epoch stats:     Loss: 0.0646 - F1-Score: 0.9845 - Accuracy-Score: 0.9711 - AUROC: 0.9901 - AP: 0.9993
[37m2024-05-28 07:53:41,597 [INFO] - Validation epoch stats:   Loss: 0.0684 - F1-Score: 0.9831 - Accuracy-Score: 0.9683 - AUROC: 0.9868 - AP: 0.9992
[37m2024-05-28 07:53:41,601 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:54:35,764 [INFO] - Final WSI level detection score (mAP): 0.4512
[37m2024-05-28 07:54:35,807 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:54:36,143 [INFO] - Epoch: 6/50
[37m2024-05-28 07:54:41,651 [INFO] - Training epoch stats:     Loss: 0.0622 - F1-Score: 0.9851 - Accuracy-Score: 0.9723 - AUROC: 0.9909 - AP: 0.9993
[37m2024-05-28 07:54:42,563 [INFO] - Validation epoch stats:   Loss: 0.0674 - F1-Score: 0.9834 - Accuracy-Score: 0.9687 - AUROC: 0.9869 - AP: 0.9992
[37m2024-05-28 07:54:42,568 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:55:34,860 [INFO] - Final WSI level detection score (mAP): 0.4536
[37m2024-05-28 07:55:34,913 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:55:35,244 [INFO] - Epoch: 7/50
[37m2024-05-28 07:55:41,032 [INFO] - Training epoch stats:     Loss: 0.0601 - F1-Score: 0.9859 - Accuracy-Score: 0.9738 - AUROC: 0.9916 - AP: 0.9994
[37m2024-05-28 07:55:41,675 [INFO] - Validation epoch stats:   Loss: 0.0666 - F1-Score: 0.9836 - Accuracy-Score: 0.9691 - AUROC: 0.9873 - AP: 0.9992
[37m2024-05-28 07:55:41,681 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:56:35,865 [INFO] - Final WSI level detection score (mAP): 0.4682
[37m2024-05-28 07:56:35,900 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:56:36,239 [INFO] - Epoch: 8/50
[37m2024-05-28 07:56:42,552 [INFO] - Training epoch stats:     Loss: 0.0586 - F1-Score: 0.9864 - Accuracy-Score: 0.9747 - AUROC: 0.9920 - AP: 0.9994
[37m2024-05-28 07:56:44,072 [INFO] - Validation epoch stats:   Loss: 0.0674 - F1-Score: 0.9833 - Accuracy-Score: 0.9686 - AUROC: 0.9873 - AP: 0.9992
[37m2024-05-28 07:56:44,077 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:57:39,699 [INFO] - Final WSI level detection score (mAP): 0.4626
[37m2024-05-28 07:57:39,893 [INFO] - Epoch: 9/50
[37m2024-05-28 07:57:47,263 [INFO] - Training epoch stats:     Loss: 0.0569 - F1-Score: 0.9868 - Accuracy-Score: 0.9754 - AUROC: 0.9925 - AP: 0.9994
[37m2024-05-28 07:57:47,974 [INFO] - Validation epoch stats:   Loss: 0.0668 - F1-Score: 0.9834 - Accuracy-Score: 0.9689 - AUROC: 0.9875 - AP: 0.9992
[37m2024-05-28 07:57:47,979 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:58:41,105 [INFO] - Final WSI level detection score (mAP): 0.4733
[37m2024-05-28 07:58:41,165 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:58:41,495 [INFO] - Epoch: 10/50
[37m2024-05-28 07:58:48,545 [INFO] - Training epoch stats:     Loss: 0.0557 - F1-Score: 0.9871 - Accuracy-Score: 0.9761 - AUROC: 0.9929 - AP: 0.9995
[37m2024-05-28 07:58:49,201 [INFO] - Validation epoch stats:   Loss: 0.0657 - F1-Score: 0.9838 - Accuracy-Score: 0.9695 - AUROC: 0.9877 - AP: 0.9992
[37m2024-05-28 07:58:49,206 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 07:59:42,271 [INFO] - Final WSI level detection score (mAP): 0.4772
[37m2024-05-28 07:59:42,309 [INFO] - New best model - save checkpoint
[37m2024-05-28 07:59:42,650 [INFO] - Epoch: 11/50
[37m2024-05-28 07:59:47,738 [INFO] - Training epoch stats:     Loss: 0.0547 - F1-Score: 0.9874 - Accuracy-Score: 0.9766 - AUROC: 0.9931 - AP: 0.9995
[37m2024-05-28 07:59:48,406 [INFO] - Validation epoch stats:   Loss: 0.0661 - F1-Score: 0.9836 - Accuracy-Score: 0.9691 - AUROC: 0.9876 - AP: 0.9992
[37m2024-05-28 07:59:48,411 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:00:39,785 [INFO] - Final WSI level detection score (mAP): 0.4749
[37m2024-05-28 08:00:39,979 [INFO] - Epoch: 12/50
[37m2024-05-28 08:00:47,346 [INFO] - Training epoch stats:     Loss: 0.0535 - F1-Score: 0.9879 - Accuracy-Score: 0.9775 - AUROC: 0.9935 - AP: 0.9995
[37m2024-05-28 08:00:48,331 [INFO] - Validation epoch stats:   Loss: 0.0656 - F1-Score: 0.9838 - Accuracy-Score: 0.9695 - AUROC: 0.9878 - AP: 0.9992
[37m2024-05-28 08:00:48,336 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:01:40,361 [INFO] - Final WSI level detection score (mAP): 0.4784
[37m2024-05-28 08:01:40,392 [INFO] - New best model - save checkpoint
[37m2024-05-28 08:01:40,729 [INFO] - Epoch: 13/50
[37m2024-05-28 08:01:47,735 [INFO] - Training epoch stats:     Loss: 0.0522 - F1-Score: 0.9882 - Accuracy-Score: 0.9781 - AUROC: 0.9938 - AP: 0.9995
[37m2024-05-28 08:01:48,377 [INFO] - Validation epoch stats:   Loss: 0.0660 - F1-Score: 0.9838 - Accuracy-Score: 0.9695 - AUROC: 0.9878 - AP: 0.9992
[37m2024-05-28 08:01:48,382 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:02:56,362 [INFO] - Final WSI level detection score (mAP): 0.4743
[37m2024-05-28 08:02:56,537 [INFO] - Epoch: 14/50
[37m2024-05-28 08:03:03,133 [INFO] - Training epoch stats:     Loss: 0.0513 - F1-Score: 0.9886 - Accuracy-Score: 0.9788 - AUROC: 0.9941 - AP: 0.9996
[37m2024-05-28 08:03:03,796 [INFO] - Validation epoch stats:   Loss: 0.0657 - F1-Score: 0.9835 - Accuracy-Score: 0.9691 - AUROC: 0.9879 - AP: 0.9992
[37m2024-05-28 08:03:03,801 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:04:01,432 [INFO] - Final WSI level detection score (mAP): 0.4768
[37m2024-05-28 08:04:01,608 [INFO] - Epoch: 15/50
[37m2024-05-28 08:04:07,331 [INFO] - Training epoch stats:     Loss: 0.0504 - F1-Score: 0.9888 - Accuracy-Score: 0.9791 - AUROC: 0.9943 - AP: 0.9996
[37m2024-05-28 08:04:08,034 [INFO] - Validation epoch stats:   Loss: 0.0661 - F1-Score: 0.9835 - Accuracy-Score: 0.9691 - AUROC: 0.9878 - AP: 0.9992
[37m2024-05-28 08:04:08,039 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:05:06,510 [INFO] - Final WSI level detection score (mAP): 0.4734
[37m2024-05-28 08:05:06,713 [INFO] - Epoch: 16/50
[37m2024-05-28 08:05:12,831 [INFO] - Training epoch stats:     Loss: 0.0497 - F1-Score: 0.9890 - Accuracy-Score: 0.9796 - AUROC: 0.9945 - AP: 0.9996
[37m2024-05-28 08:05:13,950 [INFO] - Validation epoch stats:   Loss: 0.0667 - F1-Score: 0.9836 - Accuracy-Score: 0.9692 - AUROC: 0.9878 - AP: 0.9992
[37m2024-05-28 08:05:13,955 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:06:33,360 [INFO] - Final WSI level detection score (mAP): 0.4685
[37m2024-05-28 08:06:33,528 [INFO] - Epoch: 17/50
[37m2024-05-28 08:06:40,651 [INFO] - Training epoch stats:     Loss: 0.0488 - F1-Score: 0.9892 - Accuracy-Score: 0.9799 - AUROC: 0.9947 - AP: 0.9996
[37m2024-05-28 08:06:41,714 [INFO] - Validation epoch stats:   Loss: 0.0658 - F1-Score: 0.9837 - Accuracy-Score: 0.9694 - AUROC: 0.9880 - AP: 0.9993
[37m2024-05-28 08:06:41,719 [INFO] - Calculating mAP for all cells in validation dataset
[37m2024-05-28 08:07:38,355 [INFO] - Final WSI level detection score (mAP): 0.4722
[37m2024-05-28 08:07:38,389 [INFO] - Performing early stopping!
[37m2024-05-28 08:07:38,406 [INFO] - Finished run hvs74jel
